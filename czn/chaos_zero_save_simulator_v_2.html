<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>카오스 제로 나이트메어 - 세이브 시뮬레이터 v2</title>
<style>
/* 게이밍 스타일 다크 네온 */
:root{
  --bg:#121212;
  --panel:#1a1a1a;
  --text:#e0e0e0;
  --highlight:#5cc9f5;
  --accent:#9b59b6;
  --danger:#ff4d4d;
  --success:#27e08a;
}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text)}
.wrap{max-width:1100px;margin:20px auto;padding:20px;background:var(--panel);border-radius:12px;}
h1{margin:0 0 12px;color:var(--highlight)}
p.lead{margin:0 0 16px;color:#aaa}
.grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
.panel{background:#1f1f1f;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.05)}
label{font-size:12px;color:#aaa;margin-bottom:4px;display:block}
input, select{width:100%;padding:6px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:var(--text)}
.btn{padding:6px 12px;border-radius:6px;border:none;cursor:pointer;background:var(--highlight);color:#121212;font-weight:600;transition:0.2s}
.btn:hover{box-shadow:0 0 8px var(--highlight)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--highlight)}
.card-list{display:flex;flex-direction:column;gap:8px;max-height:480px;overflow:auto}
.card-item{background:#232323;padding:10px;border-radius:8px;display:grid;grid-template-columns:120px 1fr 40px;gap:8px;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,0.5)}
.gauge-wrap{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);margin-bottom:12px}
.gauge{height:24px;background:rgba(255,255,255,0.05);border-radius:8px;overflow:hidden;position:relative}
.gauge-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--highlight),var(--accent));transition:width 300ms ease}
.gauge-text{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;color:#fff;font-size:12px}
.logs{height:200px;overflow:auto;background:rgba(0,0,0,0.25);padding:6px;border-radius:6px;font-family:monospace;font-size:12px}
.alert{display:none;padding:10px;border-radius:8px;text-align:center;font-weight:700;color:#121212;background:var(--danger);opacity:0.9;transition:0.3s}
.muted{color:#aaa}
.flex{display:flex;gap:8px;align-items:center}
.right{text-align:right}
</style>
</head>
<body>
<div class="wrap">
<h1>카오스 제로 나이트메어 - 세이브 시뮬레이터 v2</h1>
<p class="lead">일반/스페셜 카드 모두 계산 가능. 제거/복제/신번뜩임 포함. 게이밍 스타일 UI.</p>
<div class="grid">
<div>
<div class="panel" style="margin-bottom:12px">
<div class="flex" style="justify-content:space-between;align-items:center">
<div style="flex:1"><label>티어 (Tier)</label><input id="tier" type="number" min="1" value="1"/></div>
<div style="width:120px"><label>상한(pt)</label><input id="cap" type="text" readonly value="30"/></div>
<div style="width:120px"><label>총 pt</label><input id="totalPt" type="text" readonly value="0"/></div>
</div>
</div>
<div class="panel" style="margin-bottom:12px">
<div class="flex" style="justify-content:space-between;align-items:center;margin-bottom:8px">
<strong style="color:var(--highlight)">카드 목록</strong>
<div class="flex"><button id="addCard" class="btn">카드 추가</button><button id="clearCards" class="btn ghost">초기화</button></div>
</div>
<div class="card-list" id="cardList"></div>
</div>
<div class="panel">
<div class="gauge-wrap">
<div class="gauge"><div id="gaugeFill" class="gauge-fill"></div><div id="gaugeText" class="gauge-text">0 / 30 pt</div></div>
</div>
<div id="alertFull" class="alert">기억 게이지가 꽉 찼습니다!</div>
</div>
</div>
<div>
<div class="panel" style="margin-bottom:12px">
<strong style="color:var(--highlight)">실행 로그</strong>
<div id="logs" class="logs"></div>
<div class="flex" style="justify-content:flex-end;margin-top:6px"><button id="exportLog" class="btn ghost">로그 복사</button><button id="downloadJson" class="btn">JSON 내려받기</button></div>
</div>
<div class="panel">
<strong style="color:var(--accent)">요약</strong>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px">
<div><div class="small muted">저장 상한</div><div id="summaryCap" style="font-weight:700">30 pt</div></div>
<div><div class="small muted">총 누적 pt</div><div id="summaryTotal" style="font-weight:700">0 pt</div></div>
<div><div class="small muted">금기카드 수</div><div id="summaryTaboo" style="font-weight:700">0</div></div>
<div><div class="small muted">카드 수</div><div id="summaryCount" style="font-weight:700">0</div></div>
</div>
</div>
</div>
</div>
<template id="cardTemplate">
<div class="card-item">
<div style="display:flex;flex-direction:column;gap:4px">
<select class="card-type"><option value="normal">일반 카드</option><option value="special">스페셜 카드</option><option value="taboo">금기 카드</option></select>
</div>
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;align-items:center">
<div><label class="small muted">상태</label><select class="state"><option value="normal">일반</option><option value="spark">번뜩임</option><option value="newspark">신 번뜩임</option></select></div>
<div><label class="small muted">제거</label><input class="num-input remove-count" type="number" min="0" value="0"/></div>
<div><label class="small muted">복제</label><input class="num-input dup-count" type="number" min="0" value="0"/></div>
<div><label class="small muted">변환</label><input class="num-input trans-count" type="number" min="0" value="0"/></div>
<div><label class="small muted">고유</label><input type="checkbox" class="is-unique"/></div>
<div><label class="small muted">시작 제거</label><input type="checkbox" class="is-startremove"/></div>
</div>
<div style="display:flex;flex-direction:column;align-items:flex-end"><div class="small muted right">기여: <span class="contrib">0</span> pt</div><div style="display:flex;gap:4px;margin-top:4px"><button class="btn ghost remove-btn">제거</button></div></div>
</div>
</template>
<script>
const BASE={normal:20,special:80,taboo:20};
const REMAP={1:0,2:10,3:30,4:50};
const tierEl=document.getElementById('tier');
const capEl=document.getElementById('cap');
const totalPtEl=document.getElementById('totalPt');
const cardListEl=document.getElementById('cardList');
const addCardBtn=document.getElementById('addCard');
const clearCardsBtn=document.getElementById('clearCards');
const cardTemplate=document.getElementById('cardTemplate');
const gaugeFill=document.getElementById('gaugeFill');
const gaugeText=document.getElementById('gaugeText');
const alertFull=document.getElementById('alertFull');
const logsEl=document.getElementById('logs');
const summaryCap=document.getElementById('summaryCap');
const summaryTotal=document.getElementById('summaryTotal');
const summaryTaboo=document.getElementById('summaryTaboo');
const summaryCount=document.getElementById('summaryCount');
const exportLogBtn=document.getElementById('exportLog');
const downloadJsonBtn=document.getElementById('downloadJson');
let logs=[];
function calcCap(t){return 30+(Math.max(1,t)-1)*10;}
function mapCountToPt(c){c=parseInt(c)||0;if(c<=1)return 0;if(c>=5)return 70;return REMAP[c]||0;}
function escapeHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function addLog(t){logs.unshift(`[${new Date().toLocaleTimeString()}] ${t}`);renderLogs();}
function renderLogs(){logsEl.innerHTML=logs.map(l=>`<div>${escapeHtml(l)}</div>`).join('');}
function createCard(){const n=document.importNode(cardTemplate.content,true);const el=n.querySelector('.card-item');el.querySelectorAll('select,input').forEach(i=>i.addEventListener('input',updateAll));el.querySelector('.remove-btn').addEventListener('click',()=>{el.remove();updateAll();addLog('카드 제거')});cardListEl.prepend(el);updateAll();}
addCardBtn.addEventListener('click',()=>{createCard();addLog('카드 추가')});
clearCardsBtn.addEventListener('click',()=>{if(confirm('모든 카드 초기화?')){cardListEl.innerHTML='';updateAll();addLog('카드 목록 초기화')}});
tierEl.addEventListener('input',updateAll);
function calcCardContribution(el){const type=el.querySelector('.card-type').value;const state=el.querySelector('.state').value;const removeCount=parseInt(el.querySelector('.remove-count').value)||0;const dupCount=parseInt(el.querySelector('.dup-count').value)||0;const transCount=parseInt(el.querySelector('.trans-count').value)||0;const isUnique=el.querySelector('.is-unique').checked;const isStartRemove=el.querySelector('.is-startremove').checked;let details=[];let base=BASE[type]||0;details.push(`기본(${type}): ${base}pt`);let sparkAdd=0;if(state==='spark'){sparkAdd=isUnique?0:10;details.push(sparkAdd>0?`번뜩임: +${sparkAdd}pt`:'고유카드 번뜩임: +0pt');}else if(state==='newspark'){sparkAdd=20;details.push(`신 번뜩임: +${sparkAdd}pt`);}const removePt=mapCountToPt(removeCount);if(removeCount>0)details.push(`제거 ${removeCount}회 → ${removePt}pt`);let removeExtra=0;if(removeCount>0&&(isStartRemove||state==='spark'||state==='newspark')){removeExtra=20;details.push('제거 추가(시작/번뜩임): +20pt');}const dupPt=mapCountToPt(dupCount);if(dupCount>0)details.push(`복제 ${dupCount}회 → ${dupPt}pt`);let dupSparkAdd=0;if(dupCount>0&&(state==='spark'||state==='newspark')){dupSparkAdd=state==='spark'?isUnique?0:10:20;details.push(`복제 카드 번뜩임 보정: +${dupSparkAdd}pt`);}const transPt=transCount*10;if(transCount>0)details.push(`변환 ${transCount}회 → ${transPt}pt`);let transSparkAdd=0;if(transCount>0&&(state==='spark'||state==='newspark')){transSparkAdd=state==='spark'?isUnique?0:10:20;details.push(`변환 카드 번뜩임 보정: +${transSparkAdd}pt`);}let total=0;if(type==='taboo'){total+=base;details.push('금기카드: 항상 저장(20pt)');}else{total+=base;sparkAdd>0&&(total+=sparkAdd);total+=removePt+removeExtra;total+=dupPt;total+=dupSparkAdd*dupCount;total+=transPt;total+=transSparkAdd*transCount;}el.querySelector('.contrib').textContent=total;return{total,summary:`카드(${type}, 상태:${state}${isUnique?', 고유':''}) 기여 = ${total}pt | ${details.join(' / ')}`,type};}
function updateAll(){const tier=parseInt(tierEl.value)||1;const cap=calcCap(tier);capEl.value=cap;summaryCap.textContent=`${cap} pt`;let total=0,tabooCount=0,cardCount=0;const children=Array.from(cardListEl.querySelectorAll('.card-item'));const contributions=[];children.forEach(c=>{const r=calcCardContribution(c);contributions.push(r);total+=r.total;if(r.type==='taboo')tabooCount++;cardCount++;});totalPtEl.value=total;summaryTotal.textContent=`${total} pt`;summaryTaboo.textContent=tabooCount;summaryCount.textContent=cardCount;const pct=Math.min(100,Math.round((total/cap)*100));gaugeFill.style.width=pct+'%';gaugeText.textContent=`${total} / ${cap} pt`;const now=new Date();const summaryLog=`계산: Tier ${tier} (Cap ${cap}pt) → 총 ${total}pt, 카드 ${cardCount}개, 금기 ${tabooCount}개`;if(!logs.length||!logs[0].includes('계산:'))logs.unshift(`[${now.toLocaleTimeString()}] ${summaryLog}`);else logs[0]=`[${now.toLocaleTimeString()}] ${summaryLog}`;contributions.forEach(c=>logs.splice(1,0,`[${now.toLocaleTimeString()}] ${c.summary}`));if(logs.length>200)logs=logs.slice(0,200);renderLogs();alertFull.style.display=total>=cap?'block':'none';}
exportLogBtn.addEventListener('click',()=>{navigator.clipboard.writeText(logs.join('\n')).then(()=>alert('로그 복사됨')).catch(()=>alert('복사 실패'));});
downloadJsonBtn.addEventListener('click',()=>{const data={tier:parseInt(tierEl.value)||1,cap:capEl.value,totalPt:totalPtEl.value,cards:Array.from(cardListEl.querySelectorAll('.card-item')).map(el=>({type:el.querySelector('.card-type').value,state:el.querySelector('.state').value,removeCount:parseInt(el.querySelector('.remove-count').value)||0,dupCount:parseInt(el.querySelector('.dup-count').value)||0,transCount:parseInt(el.querySelector('.trans-count').value)||0,isUnique:el.querySelector('.is-unique').checked,isStartRemove:el.querySelector('.is-startremove').checked,contrib:parseInt(el.querySelector('.contrib').textContent)||0}))};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='chaos_save_simulator_v2.json';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);});
createCard();createCard();updateAll();
</script>
</body>
</html>